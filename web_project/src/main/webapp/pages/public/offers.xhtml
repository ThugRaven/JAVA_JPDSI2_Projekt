<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/page-template.xhtml">
	<ui:define name="title">
		Ogłoszenia - Vehicle Marketplace
	</ui:define>

	<ui:define name="pageContent">
		<h:form id="offerForm">
			<p:dataView id="offerTable" var="o" widgetVar="offerTable"
				value="#{offerListBB.lazyOffers}" paginator="true"
				paginatorPosition="bottom" rows="5"
				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="1,5,10,15" allowUnsorting="true"
				sortMode="multiple" gridIcon="pi pi-th-large" listIcon="pi pi-bars">

				<f:facet name="header">
					<div class="formgrid grid">
						<div class="field col-6 xl:col-2">
							<p:selectOneMenu id="bodyStyle"
								value="#{offerListBB.offerFilter.bodyStyle.idBodyStyle}"
								styleClass="inputfield w-full">
								<f:selectItem itemLabel="Typ nadwozia" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{offerListBB.bodyStyles}" var="b"
									itemLabel="#{b.name}" itemValue="#{b.idBodyStyle}" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
							</p:selectOneMenu>
							<p:message for="bodyStyle" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:selectOneMenu id="brand"
								value="#{offerListBB.offerFilter.brand.idBrand}"
								styleClass="inputfield w-full">
								<f:selectItem itemLabel="Marka" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{offerListBB.brands}" var="b"
									itemLabel="#{b.object.name} (#{b.count})"
									itemValue="#{b.object.idBrand}" />
								<p:ajax listener="#{offerListBB.changeBrand}"
									update="model generation @obs(count)" />
							</p:selectOneMenu>
							<p:message for="brand" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:selectOneMenu id="model"
								value="#{offerListBB.offerFilter.model.idModel}"
								styleClass="inputfield w-full">
								<f:selectItem itemLabel="Model" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{offerListBB.models}" var="m"
									itemLabel="#{m.object.name} (#{m.count})"
									itemValue="#{m.object.idModel}" />
								<p:ajax listener="#{offerListBB.changeModel}"
									update="generation @obs(count)" />
							</p:selectOneMenu>
							<p:message for="model" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:selectOneMenu id="generation"
								value="#{offerListBB.offerFilter.generation.idGeneration}"
								styleClass="inputfield w-full">
								<f:selectItem itemLabel="Generacja" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{offerListBB.generations}" var="g"
									itemLabel="#{g.object.name} (#{g.count})"
									itemValue="#{g.object.idGeneration}" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
							</p:selectOneMenu>
							<p:message for="generation" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:autoComplete id="priceFrom" widgetVar="priceFrom"
								value="#{offerListBB.offerFilterFrom.price}"
								placeholder="Cena od"
								completeMethod="#{offerListBB.completePrices}"
								autoHighlight="false" scrollHeight="250"
								styleClass="inputfield w-full" inputStyle="width:100%">
								<p:ajax event="focus" oncomplete="PF('priceFrom').search('')" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
								<p:keyFilter mask="num" />
							</p:autoComplete>
							<p:message for="priceFrom" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:autoComplete id="priceTo" widgetVar="priceTo"
								value="#{offerListBB.offerFilterTo.price}" placeholder="Cena do"
								completeMethod="#{offerListBB.completePrices}"
								autoHighlight="false" scrollHeight="250"
								styleClass="inputfield w-full" inputStyle="width:100%">
								<p:ajax event="focus" oncomplete="PF('priceTo').search('')" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
								<p:keyFilter mask="num" />
							</p:autoComplete>
							<p:message for="priceTo" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:autoComplete id="productionYearFrom"
								widgetVar="productionYearFrom"
								value="#{offerListBB.offerFilterFrom.productionYear}"
								validatorMessage="Błąd formatu roku"
								converterMessage="Błąd konwersji roku"
								placeholder="Rok produkcji od"
								completeMethod="#{offerListBB.completeYears}" scrollHeight="250"
								styleClass="inputfield w-full" inputStyle="width:100%">
								<p:ajax event="focus"
									oncomplete="PF('productionYearFrom').search('')" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
								<f:validateLength minimum="4" maximum="4" />
								<p:keyFilter mask="num" />
							</p:autoComplete>
							<p:message for="productionYearFrom" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:autoComplete id="productionYearTo"
								widgetVar="productionYearTo"
								value="#{offerListBB.offerFilterTo.productionYear}"
								validatorMessage="Błąd formatu roku"
								converterMessage="Błąd konwersji roku"
								placeholder="Rok produkcji do"
								completeMethod="#{offerListBB.completeYears}" scrollHeight="250"
								styleClass="inputfield w-full" inputStyle="width:100%">
								<p:ajax event="focus"
									oncomplete="PF('productionYearTo').search('')" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
								<f:validateLength minimum="4" maximum="4" />
								<p:keyFilter mask="num" />
							</p:autoComplete>
							<p:message for="productionYearTo" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:selectOneMenu id="fuel"
								value="#{offerListBB.offerFilter.fuel}"
								styleClass="inputfield w-full">
								<f:selectItem itemLabel="Rodzaj paliwa" itemValue="#{null}"
									noSelectionOption="true" />
								<f:selectItems value="#{constantsBB.fuels}" var="f"
									itemLabel="#{f}" itemValue="#{f}" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
							</p:selectOneMenu>
							<p:message for="fuel" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:autoComplete id="mileageFrom" widgetVar="mileageFrom"
								value="#{offerListBB.offerFilterFrom.mileage}"
								placeholder="Przebieg od"
								completeMethod="#{offerListBB.completeMileages}"
								autoHighlight="false" scrollHeight="250"
								styleClass="inputfield w-full" inputStyle="width:100%">
								<p:ajax event="focus" oncomplete="PF('mileageFrom').search('')" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
								<p:keyFilter mask="num" />
							</p:autoComplete>
							<p:message for="mileageFrom" />
						</div>

						<div class="field col-6 xl:col-2">
							<p:autoComplete id="mileageTo" widgetVar="mileageTo"
								value="#{offerListBB.offerFilterTo.mileage}"
								placeholder="Przebieg do"
								completeMethod="#{offerListBB.completeMileages}"
								autoHighlight="false" scrollHeight="250"
								styleClass="inputfield w-full" inputStyle="width:100%">
								<p:ajax event="focus" oncomplete="PF('mileageTo').search('')" />
								<p:ajax update="@obs(count)"
									listener="#{offerListBB.countLazyList()}" />
								<p:keyFilter mask="num" />
							</p:autoComplete>
							<p:message for="mileageTo" />
						</div>
					</div>
					<div
						class="flex flex-row justify-content-between md:justify-content-end w-full mt-0 mb-4">
						<p:commandButton value="Status pojazdu" type="button"
							onclick="PF('vehicleStatusDialog').show()"
							styleClass="w-full md:w-auto mr-2" />

						<p:commandButton value="Silnik i napęd" type="button"
							onclick="PF('engineDriveDialog').show()"
							styleClass="w-full md:w-auto mr-2" />

						<p:commandButton value="Nadwozie" type="button"
							onclick="PF('bodyDialog').show()" styleClass="w-full md:w-auto" />
					</div>

					<p:dialog header="Status pojazdu" widgetVar="vehicleStatusDialog"
						modal="true" showEffect="fade" hideEffect="fade" resizable="false"
						draggable="false" closeOnEscape="true" responsive="true">
						<p:outputPanel id="vehicleStatus">
							<h:panelGrid columns="3" cellpadding="5">
								<p:selectBooleanCheckbox
									value="#{offerListBB.offerFilter.licensePlate}"
									itemLabel="Ma numer rejestracyjny">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectBooleanCheckbox>

								<p:outputLabel for="@next" value="Uszkodzony" />
								<p:selectOneMenu value="#{offerListBB.offerFilter.isDamaged}">
									<f:selectItem itemLabel="Wszystkie" itemValue="#{null}"
										noSelectionOption="true" />
									<f:selectItem itemLabel="Nie" itemValue="#{false}" />
									<f:selectItem itemLabel="Tak" itemValue="#{true}" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectOneMenu>
								<p:message for="@previous" />

								<p:selectBooleanCheckbox
									value="#{offerListBB.offerFilter.isAccidentFree}"
									itemLabel="Bezwypadkowy">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectBooleanCheckbox>

								<p:selectBooleanCheckbox
									value="#{offerListBB.offerFilter.isFirstOwner}"
									itemLabel="Pierwszy właściciel">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectBooleanCheckbox>

								<p:selectBooleanCheckbox
									value="#{offerListBB.offerFilter.isRegistered}"
									itemLabel="Zarejestrowany w Polsce">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectBooleanCheckbox>

								<p:selectBooleanCheckbox
									value="#{offerListBB.offerFilter.isRightHandDrive}"
									itemLabel="Kierownica po prawej (Anglik)">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectBooleanCheckbox>
							</h:panelGrid>

							<p:commandButton
								value="Pokaż wyniki (#{offerListBB.countListText()})"
								update="offerTable">
								<p:autoUpdate on="count" />
							</p:commandButton>

							<p:commandButton value="Wyczyść"
								action="#{offerListBB.clearVehicleStatus()}" />
						</p:outputPanel>
					</p:dialog>

					<p:dialog header="Silnik i napęd" widgetVar="engineDriveDialog"
						modal="true" showEffect="fade" hideEffect="fade" resizable="false"
						draggable="false" closeOnEscape="true" responsive="true">
						<p:outputPanel id="engineDrive">
							<h:panelGrid columns="3" cellpadding="5">
								<p:outputLabel for="@next" value="Pojemność skokowa od" />
								<p:inputNumber id="displacementFrom"
									value="#{offerListBB.offerFilterFrom.displacement}"
									decimalPlaces="0" minValue="0">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:inputNumber>
								<p:message for="@previous" />

								<p:outputLabel for="@next" value="Pojemność skokowa do" />
								<p:inputNumber id="displacementTo"
									value="#{offerListBB.offerFilterTo.displacement}"
									decimalPlaces="0" minValue="0">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:inputNumber>
								<p:message for="@previous" />

								<p:outputLabel for="@next" value="Moc od" />
								<p:inputNumber id="powerFrom"
									value="#{offerListBB.offerFilterFrom.power}" decimalPlaces="0"
									minValue="0">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:inputNumber>
								<p:message for="@previous" />

								<p:outputLabel for="@next" value="Moc do" />
								<p:inputNumber id="powerTo"
									value="#{offerListBB.offerFilterTo.power}" decimalPlaces="0"
									minValue="0">
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:inputNumber>
								<p:message for="@previous" />

								<p:outputLabel for="@next" value="Skrzynia biegów" />
								<p:selectManyCheckbox
									value="#{offerListBB.offerFilterList.get(0).values}"
									layout="grid" columns="3" styleClass="grid-checkbox">
									<f:selectItems value="#{constantsBB.transmissions}" var="t"
										itemLabel="#{t}" itemValue="#{t}" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectManyCheckbox>

								<p:outputLabel for="@next" value="Napęd" />
								<p:selectManyCheckbox
									value="#{offerListBB.offerFilterList.get(1).values}"
									layout="grid" columns="3" styleClass="grid-checkbox">
									<f:selectItems value="#{constantsBB.drives}" var="d" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectManyCheckbox>
							</h:panelGrid>

							<p:commandButton
								value="Pokaż wyniki (#{offerListBB.countListText()})"
								update="offerTable">
								<p:autoUpdate on="count" />
							</p:commandButton>

							<p:commandButton value="Wyczyść"
								action="#{offerListBB.clearEngineDrive()}" />
						</p:outputPanel>
					</p:dialog>

					<p:dialog header="Nadwozie" widgetVar="bodyDialog" modal="true"
						showEffect="fade" hideEffect="fade" resizable="false"
						draggable="false" closeOnEscape="true" responsive="true">
						<p:outputPanel id="body">
							<h:panelGrid columns="3" cellpadding="5">
								<p:outputLabel for="@next" value="Liczba drzwi" />
								<p:selectManyCheckbox
									value="#{offerListBB.offerFilterList.get(2).values}"
									layout="grid" columns="3" styleClass="grid-checkbox">
									<f:selectItems value="#{constantsBB.doors}" var="d" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectManyCheckbox>

								<p:outputLabel for="@next" value="Liczba miejsc" />
								<p:selectManyCheckbox
									value="#{offerListBB.offerFilterList.get(3).values}"
									layout="grid" columns="3" styleClass="grid-checkbox">
									<f:selectItems value="#{constantsBB.seats}" var="s" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectManyCheckbox>

								<p:outputLabel for="@next" value="Kolor" />
								<p:selectManyMenu
									value="#{offerListBB.offerFilterList.get(4).values}"
									showCheckbox="true">
									<f:selectItems value="#{constantsBB.colors}" var="c" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectManyMenu>

								<p:outputLabel for="@next" value="Rodzaj koloru" />
								<p:selectManyCheckbox
									value="#{offerListBB.offerFilterList.get(5).values}"
									layout="grid" columns="3" styleClass="grid-checkbox">
									<f:selectItems value="#{constantsBB.colorTypes}" var="c"
										itemLabel="#{c}" itemValue="#{c}" />
									<p:ajax update="@obs(count)"
										listener="#{offerListBB.countLazyList()}" />
								</p:selectManyCheckbox>
							</h:panelGrid>

							<p:commandButton
								value="Pokaż wyniki (#{offerListBB.countListText()})"
								update="offerTable">
								<p:autoUpdate on="count" />
							</p:commandButton>

							<p:commandButton value="Wyczyść"
								action="#{offerListBB.clearBody()}" />
						</p:outputPanel>
					</p:dialog>

					<div
						class="flex flex-row justify-content-between md:justify-content-end w-full">
						<p:commandButton
							value="Pokaż wyniki (#{offerListBB.countListText()})"
							update="offerTable" styleClass="w-full md:w-auto mr-2">
							<p:autoUpdate on="count" />
						</p:commandButton>

						<p:commandButton value="Wyczyść"
							action="#{offerListBB.clearFilters()}" update="offerTable"
							styleClass="w-full md:w-auto ui-button-outlined ui-button-danger" />
					</div>

					<h2 class="text-left">Samochody -
						#{offerListBB.lazyOffers.rowCount}
						#{offerListBB.getCountText(null)}</h2>
				</f:facet>

				<p:dataViewListItem>
					<p:link outcome="/pages/public/offer?faces-redirect=true"
						styleClass="no-underline">
						<f:param name="c"
							value="#{o.brand.name} #{o.model.name} #{o.title}" />
						<f:param name="o" value="#{o.idOffer}" />
						<div
							class="p-4 mb-2 border-1 border-200 list__content flex flex-row text-800">
							<p:graphicImage rendered="#{not empty o.image}"
								value="/offer_images/#{o.image}"
								styleClass="list__image flex-shrink-0 surface-200" />
							<div class="mx-3 flex flex-column">
								<span class="text-xl text-900 font-medium list__title">#{o.brand.name}
									#{o.model.name} <h:outputText value="#{o.displacement / 1000}">
										<f:convertNumber type="number" pattern="0.0" locale="en_US" />
									</h:outputText>
								</span> <span class="mt-1 text-sm">#{o.title}</span>
								<ul
									class="flex flex-row list-none list__list p-0 align-items-end flex-wrap text-sm">
									<li>#{o.productionYear}</li>
									<li><h:outputText value="#{o.mileage}">
											<f:convertNumber type="number" />
										</h:outputText> km</li>
									<li><h:outputText value="#{o.displacement}">
											<f:convertNumber type="number" />
										</h:outputText> cm<sup>3</sup></li>
									<li>#{o.fuel}</li>
								</ul>
								<div class="mt-2 text-sm">
									<i class="pi pi-map-marker font-bold" /> <span
										class="font-normal">#{o.city}</span>
								</div>
							</div>
							<div class="ml-auto font-bold text-xl text-orange-500 text-right">
								<h:outputText value="#{o.price}">
									<f:convertNumber type="number" />
								</h:outputText>
								PLN
							</div>
						</div>
					</p:link>
				</p:dataViewListItem>

				<f:facet name="footer">
					<span>W sumie jest #{offerListBB.lazyOffers.rowCount}
						ogłoszeń.</span>
				</f:facet>

			</p:dataView>

			<p:growl id="growl" for="offerTable" showDetail="true"
				skipDetailIfEqualsSummary="true" />
		</h:form>
	</ui:define>
</ui:composition>
</html>